# ==============================================================================
# NETWORKING ROLE DEFAULT VARIABLES
# ==============================================================================
#
# Default configuration variables for the Ansible networking role.
#
# These variables can be overridden, with group, host or playbook specific variables
# using the same name:
#   - group_vars/
#   - host_vars/
#   - playbook vars
#
# NOTE: Ansible will override everything under the root boilerplate_ variable. 
# Meaning you need to include all variables when overriding, else the other variables 
# will not be found.
#
# Copy the below defaults into your host_var file and overwrite with host specific
# variables
# ------------------------------------------------------------------------------

---

# ---------------------------- [ NETWORKING ] ----------------------------------

## Arti (Tor Client)
# https://gitlab.torproject.org/tpo/core/arti
networking_arti:
  user: 'arti'
  group: 'arti'
  release_tag: 'arti-v1.4.5'                        # <-- https://gitlab.torproject.org/tpo/core/arti/-/tags
  listen_address: '127.0.0.1'                       # Networking interface binding address
  socks_port: 9055                                  # TOR SOCKS proxy port
  metrics_port: 9179                                # Prometheus metrics port
  dns_port: 0                                       # 0 means disabled, when DNS is typically handled through SOCKS proxy
  log_level: 'warn'                                 # Set to info, debug, warn, error, or trace
  predicted_ports: [80, 443]

## DuckDNS Configuration
networking_ddns:
  user: 'duckdns'
  group: 'duckdns'
  domain: '{{ vault_networking_ddns_domain }}'
  token: '{{ vault_networking_ddns_token }}'


## Glance Configuration
networking_glance:
  # Installation method: 'debian' or 'docker'
  install_method: "docker"                        # Recommended: docker

  # Service configuration
  web_port: 8080                                  # Glance web UI port

  # Directory configuration
  config_dir: "/var/lib/glance"                   # Configuration directory

  # Docker configuration (when install_method: docker)
  docker_image: "glanceapp/glance:latest"
  container_name: "glance"
  timezone: "America/New_York"

  # Direct installation configuration (when install_method: debian)
  user: "glance"
  group: "glance"

  # Network settings
  allowed_networks: "192.168.1.0/255.255.255.0"   # Networks allowed to access Glance

  # Nginx location block settings
  nginx_location_url: "https://{{ networking_nginx.hostname }}/glance/"  # URL for accessing Glance via nginx

  # Monitoring settings
  metrics_enabled: false                          # Enable Prometheus metrics collection
  metrics_port: 9463                              # Prometheus metrics port
  docker_metrics_enabled: false                   # Enable Docker container metrics collection

  # Advanced settings
  debug_logging: false


## Homepage Configuration
networking_homepage:
  # Installation method: 'debian' or 'docker'
  install_method: "docker"                        # Recommended: docker

  # Service configuration
  user: 'homepage'
  group: 'homepage'
  release: 'v1.4.0' # <-- https://github.com/gethomepage/homepage/releases
  port: '3000'
  hostname: '{{ ansible_hostname }}'
  title: '{{ ansible_hostname }} - Homepage'
  description: 'A modern, fully static, fast, secure, fully proxied, highly customizable application dashboard'
  theme: 'dracula' # Options: light, dark, dracula, etc.
  allowed_hosts: '{{ ansible_hostname }}, {{ ansible_hostname }}:3000, {{ ansible_fqdn }}, {{ ansible_fqdn }}:3000' # <-- When pasting into host_vars, update to include vault_hostname_address

  # Directory configuration
  install_dir: "/opt/homepage"                    # Installation directory for Docker compose
  data_dir: '/var/lib/homepage'                   # Data directory for persistent storage
  config_dir: '/etc/homepage'                     # Configuration directory

  # Docker configuration (when install_method: docker)
  docker_image: "ghcr.io/gethomepage/homepage:latest"
  container_name: "homepage"
  timezone: "America/New_York"

  # Network settings
  allowed_networks: ["192.168.1.0/24"]            # Networks allowed to access Homepage

  # Nginx settings
  nginx_enabled: true                             # Enable nginx reverse proxy
  nginx_location_url: "/"                         # URL for accessing Homepage via nginx (root)
  nginx_path: "/homepage"                         # Nginx location path (e.g., "/" for root, "/homepage" for subpath)

  # Advanced settings
  debug_logging: false


## I2P Daemon Configuration
# https://i2pd.readthedocs.io/en/latest/configuration.html
networking_i2pd:
  user: 'i2pd'
  group: 'i2pd'
  release: '2.57.0' # <-- https://github.com/PurpleI2P/i2pd/releases
  log_level: 'info'  # Options: none, error, warn, info, debug, trace
  console:
    port: 7070
    listen_address: '127.0.0.1'
  sam:
    listen_address: '127.0.0.1'
    port_tcp: 7656
    port_udp: 7655
  path_prefix: 'i2p'


## Let's Encrypt TLS Certificate
networking_lets_encrypt:
  user: 'letsencrypt'                                                 # User for Let's Encrypt tasks
  group: 'letsencrypt'                                                # Group for Let's Encrypt tasks
  domain: '{{ ansible_fqdn }}'                                        # Domain for the certificate
  domain_email: '{{ vault_networking_domain_email }}'                 # Email for Let's Encrypt notifications
  cloudflare_dns_api_key: '{{ vault_networking_cloudflare_token }}'   # Cloudflare DNS API key
  private_key_path: '/etc/letsencrypt/live/{{ ansible_fqdn }}/privkey.pem'
  certificate_path: "/etc/letsencrypt/live/{{ ansible_fqdn }}/fullchain.pem"


## Networks configuration
networking_networks: 
  local: "{{ vault_networks_local }}"
  lan_gateway_ip: '{{ vault_networks_lan_gateway_ip }}'
  unifi_vpn_client_subnet: '{{ vault_networks_unifi_vpn_client_subnet }}'
  primary_network_interface: 'eth0'      


## NFS (Network File System) Configuration
networking_nfs:
  # Chose how to mount nfs shares. `fstab` or `systemd`
  method: "fstab"

  # The user to use when creating nfs mount points
  user: 'root'
  # Check user id on NAS
  uid: "1000"

  # The group to use when creating the nfs mount points
  group: 'root'
  # Check user group id on NAS
  gid: "1000"

  # Mount options for NFSv3
  # Enable NFS client functionality
  # NFS version (3, 4, or 4.1)
  # Mount timeout in seconds
  # Number of retransmissions
  # Read buffer size
  # Write buffer size
  options: 'vers=3,soft,timeo=30,retrans=3,rsize=32768,wsize=32768,nolock,all_squash,anonuid=1042,anongid=100'

  # NFS shares to mount (array of mount configurations)
  # Each mount should have: server, share, mount_point, owner, group, mode
  mounts:
    # Example configuration:
    # - mount_point: '/mnt/nfs-data'
    #   server: 'use-ip-address'
    #   share: '/mnt/nfs-data'
    #   owner: 'root'
    #   group: 'root'
    #   mode: '2755'
    - mount_point: "/mnt/nas/media"
      server: "192.168.1.3"
      share: "/mnt/user/media"
      mode: "2755"


## Nginx Configuration
networking_nginx:
  user: 'root'
  group: 'root'
  hostname: "{{ ansible_hostname }}"                   # Hostname for Nginx server
  sites_available_dir: "/etc/nginx/sites-available"    # Directory for Nginx site configurations
  sites_enabled_dir: "/etc/nginx/sites-enabled"        # Directory for enabled Nginx sites
  sites_location_dir: "/etc/nginx/conf.d"              # Directory for Nginx location blocks


## OpenVPN Client Configuration
networking_openvpn_client:
  user: 'root'
  group: 'root'
  config_download: "{{ vault_vpn_config_download }}"   # URL to download OpenVPN config zip
  vpn_server: '{{ vault_vpn_server }}'
  dns_servers: "209.222.18.218 209.222.18.218 1.1.1.1 9.9.9.9"           # List of DNS servers to use when VPN is active


## Samba Configuration
networking_samba:
  user: 'samba'
  group: 'samba'
  workgroup: '{{ vault_networking_domain }}'           # Samba workgroup name
  interfaces: 'lo eth0 wlan0'                          # Network interfaces for Samba
  smb_config_path: '/etc/samba/smb.conf'               # Path to Samba configuration file
  shares:
    - name: 'shared'
      path: '/srv/samba/shared'
      read_only: no
      valid_users:
        - 'user1'
        - 'user2'
  users: "{{ vault_networking_samba_users }}"         # List of users with passwords


## SSH Configuration
networking_ssh:
  user: 'root'
  group: 'root'
  listen_address: "0.0.0.0"                             # SSH listenging address
  listen_port: "22"                                     # SSH listenging port
  user_access_group: 'ssh-users'                        # Group for SSH access
  user_access_list: "{{ vault_ssh_user_access_list }}"  # List of users with SSH access


## UFW Configuration
networking_ufw:
  user: 'root'
  group: 'root'

networking_unifi:
  host: 'unifi.homenetwork.com'
  path: 'unifi'

## WireGuard VPN Configuration
networking_wireguard_vpn:
  interface_name: 'vpn_service_provider'
  private_key: "{{ vault_wireguard_private_key }}"
  public_key: "{{ vault_wireguard_public_key }}"
  address: "{{ vault_wireguard_address }}"
  dns_servers: "{{ vault_wireguard_dns }}"
  endpoint: "{{ vault_wireguard_endpoint }}"
  allowed_ips: "{{ vault_wireguard_allowed_ips }}"
  auto_start: true


## VPN Kill Switch Configuration
# Implements UFW firewall rules to block all non-VPN traffic
# This prevents data leaks when the VPN connection drops
networking_vpn_killswitch:
  # VPN server IP address
  # This allows the initial connection to the VPN server
  # WireGuard: Extracted from "Endpoint" line in /etc/wireguard/*.conf
  # OpenVPN: Extract from "remote" line in config
  vpn_server_ip: "{{ networking_wireguard_vpn.endpoint_server }}"

  # Useful for resolving VPN server hostname before connecting
  # WireGuard: Extracted from "DNS" line in /etc/wireguard/*.conf
  # OpenVPN: Not auto-detected yet, specify manually if needed
  dns_servers: "{{ networking_wireguard_vpn.dns_servers }}"

  # VPN tunnel interface
  # WireGuard: Usually matches interface_name from networking_wireguard_vpn
  # OpenVPN: Usually "tun0" or "tun1"
  # Find with: ip link show | grep -E 'tun|wg' or wg show
  vpn_interface: "{{ networking_wireguard_vpn.interface_name }}"

  # Default Interface
  # This is the physical network interface connected to the internet
  # This can be found using `ip route | grep default`
  default_interface: "xxxxx"
  
  # VPN systemd service name
  # WireGuard: "wg-quick@<interface_name>"
  # OpenVPN: "openvpn@<config_name>" or "openvpn-client@<config_name>"
  vpn_service: "xxxxx"
  

## --- HOMARR
# https://github.com/homarr-labs/homarr
networking_homarr:
  # Installation method: 'docker' or 'debian'
  install_method: "docker"                        # Installation method

  # Direct installation configuration (when install_method: debian)
  user: "homarr"
  group: "homarr"
  additional_groups:                           # Additional groups for the user
    - "nas"

  # Release version to deploy
  release: "1.43.2"                               # https://github.com/homarr-labs/homarr/releases or 'latest'

  # Service configuration
  web_port: 7575                                  # Homarr web UI port

  # Directory configuration
  install_dir: "/opt/homarr"                      # Installation directory
  data_dir: "/var/lib/homarr"                     # Data directory
  config_dir: "/etc/homarr"                       # Configuration directory

  auth_secret: "super-secret-auth"                # Optional authentication secret for Homarr

  # Network configuration
  allowed_networks:                               # Networks allowed to access Homarr
    - "192.168.1.0/24"
  nginx_enabled: true                             # Enable nginx reverse proxy
  nginx_path: "homarr"                            # URL path for nginx proxy (e.g., /homarr)

  # Docker configuration (when install_method: docker)
  docker_image: "ghcr.io/ajnart/homarr:latest"
  container_name: "homarr"
  timezone: "America/New_York"

  # Nginx location block settings
  nginx_location_url: "https://{{ networking_nginx.hostname }}/overseerr/"  # URL for accessing Overseerr via nginx

  # Advanced settings
  debug_logging: false

