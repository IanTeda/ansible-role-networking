# ============================================================================ #
# WireGuard Static VPN Route - systemd-networkd Route Template                 #
# ============================================================================ #
# ⚠️ WARNING: This file is managed by Ansible - DO NOT EDIT MANUALLY!       ⚠️ 
# Any manual changes will be overwritten on the next Ansible run.
# Edit the template file or Ansible variables instead.
#
# file_path: roles/networking/templates/wireguard-static-unifi-vpn-route.network.j2
# deploy_path: /etc/systemd/network/10-{{ wireguard_interface }}-static-vpn-route.network
# =============================================================================
#
# This systemd-networkd configuration file creates a static route to ensure
# the WireGuard VPN server is reachable via the local network gateway.
#
# When WireGuard is active, all traffic may be routed through the tunnel,
# preventing the initial connection to the VPN server. This static route
# forces traffic to the VPN server IP to go via the LAN gateway, allowing
# the WireGuard handshake to succeed.
#
# The route ensures the VPN endpoint ({{ networking_wireguard_vpn.endpoint_server }})
# is accessible before the tunnel is established.
#
# Generated by Ansible on {{ ansible_date_time.iso8601 }}
# Host: {{ ansible_fqdn }}
#
# -----------------------------------------------------------------------------

[Match]
Name={{ wireguard_interface }}

[Network]
DHCP=yes

[Route]
Gateway={{ networking_networks.lan_gateway_ip }}
Destination={{ networking_wireguard_vpn.endpoint_server }}/32

[Link]
RequiredForOnline=routable